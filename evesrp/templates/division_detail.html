{% extends "base.html" %}

{% macro add_entity_form(permission, entity) %}
{% endmacro %}

{% macro remove_entity_form(permission, entity, id) %}
{% endmacro %}

{% block head %}
{{ super() }}
<link href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet">
{% endblock head %}

{% block content %}
<div class="row">
  {% for permission in ('submit', 'review', 'pay') %}
  <div class="col-md-offset-3 col-md-6" id="{{ permission }}">
    {% if permission == 'submit' %}
    <h2>Submitters</h2>
    {% elif permission == 'review' %}
    <h2>Reviewers</h2>
    {% elif permission == 'pay' %}
    <h2>Payers</h2>
    {% endif %}
    <table class="table table-condensed">
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Authentication Source</th>
        <th>Remove</th>
      </tr>
      {% for entity in division.permissions[permission]|map(attribute='entity') %}
      <tr>
        <td>{{ entity.name }}</td>
        {% if entity.users is defined %}
        <td>Group ({{ entity.users|length }})</td>
        {% else %}
        <td>User</td>
        {% endif %}
        <td>{{ entity.authmethod().name }}</td>
        <td>
          <form method="post">
            {{ form.csrf_token() }}
            {{ form.id_(value=entity.id) }}
            {{ form.permission(value=permission) }}
            {{ form.action(value='delete') }}
            <button class="close" type="submit">&times;</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>
    <form class="form-inline" role="form" method="post" autocomplete="off">
      <div class="input-group">
        <label class="sr-only" for="add-{{ permission }}-name">Name</label>
        <input type="text" class="form-control entity-typeahead typeahead" id="add-{{ permission }}--name" name="name" autocomplete="off" placeholder="Name">
        <span class="input-group-btn">
          <button type="submit" class="btn btn-default">Add {{ entity|capitalize }}</button>
        </span>
      </div>
      {{ form.csrf_token() }}
      {{ form.action(value="add") }}
      {{ form.permission(value=permission) }}
    </form>
  </div>
{% endfor %}
</div>
{% endblock content %}

{% block scripts %}
{{ super() }}
<script src="//cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.2/typeahead.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/custom.js') }}"></script>
{% endblock scripts %}
